/* =========================================
   Projects page — natural, minimal, no H-scroll
   ========================================= */

/* -------- Palette (natural “stone + sage”) -------- */
$ink: #0f172a;          // primary text (very dark slate)
$muted: #4b5563;        // secondary text
$bg: #ffffff;           // page background
$panel: #FAFAF7;        // stone-50 panel
$border: #E7E5E4;       // stone-200 border
$accent: #EDF2EE;       // very light sage wash
$accent-ink: #3B4D3F;   // sage-gray for accents

$radius: 6px;
$shadow: 0 1px 2px rgba(2,6,23,.06), 0 8px 24px rgba(2,6,23,.04);

/* -------- HARD CLAMP AGAINST HORIZONTAL OVERFLOW (page root only) -------- */
html, body {
  max-width: 100%;
  overflow-x: hidden;            /* fallback for old browsers */
}
@supports (overflow: clip) {
  html, body { overflow-x: clip; }  /* blocks tiny left/right nudge */
}

/* Wider canvas for Projects page */
.is-projects .page-content .wrapper { max-width: 1280px; }

/* -------- Images may never set layout width -------- */
.project-section img {
  display: block;
  width: 100%;
  max-inline-size: 100%;
  height: auto;
}

/* -------- Layout -------- */
.projects-page {
  max-width: 100%;
  display: grid;
  grid-template-columns: 280px minmax(0, 1fr);
  gap: 2rem;
  align-items: start;
  /* IMPORTANT: allow shadows to render; do not clip here */
  overflow: visible;
  @media (max-width: 980px) { grid-template-columns: 1fr; }
}

.project-section {
  background: $bg;
  border: 1px solid $border;
  border-radius: $radius;
  box-shadow: $shadow;

  /* Keep child overflow contained to the card, but DO NOT clip the page at container level */
  overflow: hidden;          /* vertical & horizontal inside the card */
  max-inline-size: 100%;
  width: 100%;
}

/* -------- TOC -------- */
.projects-toc {
  position: sticky; top: 6rem; align-self: start;
  .toc-inner { background: $panel; border: 1px solid $border; border-radius: $radius; box-shadow: $shadow; padding: 1rem; }
  h2 { margin: 0 0 .5rem; font-size: .95rem; letter-spacing: .02em; color: $muted; font-weight: 600; }
  ul { list-style: none; margin: 0; padding: 0; display: grid; gap: .25rem; }
  a { display: flex; align-items: center; justify-content: space-between; padding: .5rem .625rem; border-radius: $radius; color: $ink; text-decoration: none; border: 1px solid transparent; }
  a:hover { background: lighten($panel, 2%); }
  a.active { border-color: $accent-ink; box-shadow: inset 2px 0 0 $accent-ink; }
  .toc-title { font-size: .92rem; line-height: 1.2; }
  @media (max-width: 980px) { position: static; .toc-inner { position: sticky; top: 60px; z-index: 2; } }
}

/* -------- MAIN -------- */
.projects-main { display: grid; gap: 2rem; }

/* Hero */
.project-hero {
  margin: 0;
  background: $panel;
  border-bottom: 1px solid $border;
  overflow: hidden;          /* keeps image inside rounded card */
  border-radius: $radius;
  img { display: block; width: 100%; height: auto; }
  figcaption { font-size: .85rem; color: $muted; padding: .5rem 1rem 1rem; }
}

/* Header */
.project-header { padding: 1.25rem 1.25rem 0; }
.title-row { display: flex; flex-wrap: wrap; align-items: baseline; gap: .75rem 1rem; }
.project-title { margin: 0; font-size: clamp(1.2rem, 2vw, 1.6rem); line-height: 1.2; }
.project-dates { margin-left: auto; font-size: .9rem; color: $muted; white-space: nowrap; }

/* Role line above intro */
.project-roleline { margin-top: .25rem; font-size: .9rem; color: $muted; }
.project-roleline .role { color: $ink; font-weight: 600; }
.project-roleline .sep { margin: 0 .4rem; color: $border; }

.project-oneliner { margin: .5rem 0 0; color: $ink; font-size: 1rem; }

/* Stack chips (clamped in Liquid) */
.stack-list { margin: .9rem 0 0; padding-bottom: .9rem; border-bottom: 1px solid $border; display: flex; flex-wrap: wrap; gap: .4rem; }
.stack-item { font-size: .8rem; padding: .25rem .5rem; border: 1px solid mix($accent-ink, #000, 12%); background: mix($accent, #fff, 92%); color: $ink; border-radius: $radius; }
.stack-more { font-weight: 600; }

/* -------- Impact metrics --------
   Desktop: one row, auto-fit; Mobile: swipe row (overridden later)
*/
.impact-grid {
  padding: 1rem 1.25rem 0;
  display: grid;
  grid-template-columns: repeat(var(--n, 4), minmax(0, 1fr));
  gap: .75rem;
}
.impact-card {
  min-width: 0; /* allow squeeze without overflow */
  border: 1px solid $border; border-radius: $radius; background: $panel; padding: .75rem .8rem; min-height: 96px;
}
.impact-label { font-size: .75rem; color: $muted; }
.impact-value { font-size: 1.05rem; font-weight: 700; margin-top: .15rem; color: $accent-ink; }
.impact-note  { font-size: .78rem; color: $muted; margin-top: .25rem; }

/* Summary */
.project-summary { padding: 1rem 1.25rem 0; color: $ink; }

/* Highlights — softer bullets + indent */
.highlights { padding: .5rem 1.25rem 0; }
.highlights h3 { font-size: 1rem; margin: .75rem 0 .25rem; }
.highlights ul { margin: 0 0 0 1.3rem; padding: 0; }
.highlights li { margin: .25rem 0; }
.highlights li::marker { color: $muted; font-size: .85em; }

/* Case study */
.case-study { padding: .75rem 1.25rem 0; }
.case-study details { border: 1px solid $border; border-radius: $radius; background: #fff; overflow: hidden; }
.case-study summary { cursor: pointer; list-style: none; padding: .8rem 1rem; font-weight: 600; position: relative; user-select: none; }
.case-study summary::after { content: "▸"; position: absolute; right: .8rem; top: 50%; transform: translateY(-50%); font-size: 1rem; color: $accent-ink; }
.case-study details[open] summary::after { content: "▾"; }
.case-study summary:hover { background: mix($accent, #fff, 94%); }

.case-study .panel { padding: .6rem 1rem .9rem; }
.case-study .meta-group { margin: .1rem 0 .6rem; display: grid; gap: .35rem; }
.case-study .meta-label { font-size: .78rem; color: $muted; letter-spacing: .02em; text-transform: uppercase; }
.case-study .meta-chips { display: flex; flex-wrap: wrap; gap: .35rem; }
.case-study .meta-chips .chip { font-size: .78rem; border: 1px solid $border; color: $muted; background: #fff; border-radius: 999px; padding: .22rem .5rem; }

.case-study h4 { margin: .35rem 0 .2rem; padding-top: .35rem; font-size: .95rem; color: $ink; letter-spacing: .01em; border-top: 1px solid $border; }
.case-study h4:first-of-type { border-top: 0; padding-top: 0; }
.case-study .md p { margin: 0 0 .5rem; line-height: 1.65; }
.case-study .md ul, .case-study .md ol { margin: .15rem 0 .6rem 1.3rem; }
.case-study .md li::marker { color: $muted; }

/* Links */
.project-links { padding: .75rem 1.25rem 0; display: flex; flex-wrap: wrap; gap: .5rem; }
.btn-link { display: inline-block; padding: .45rem .7rem; font-size: .85rem; color: $accent-ink; border: 1px solid $accent-ink; background: #fff; border-radius: $radius; text-decoration: none; }
.btn-link:hover { background: mix($accent, #fff, 90%); }

/* Gallery */
.project-gallery { padding: .75rem 1.25rem 0; display: grid; gap: .75rem; grid-template-columns: repeat(12, 1fr); }
.project-gallery figure { grid-column: span 4; margin: 0; background: #fff; border: 1px solid $border; border-radius: $radius; overflow: hidden; }
.project-gallery img { width: 100%; display: block; }
.project-gallery figcaption { padding: .5rem .6rem .7rem; font-size: .82rem; color: $muted; }
@media (max-width: 1100px) { .project-gallery figure { grid-column: span 6; } }
@media (max-width: 640px)  { .project-gallery figure { grid-column: span 12; } }

/* Footer — contributions + team */
.project-footer { padding: .75rem 1.25rem 1.25rem; margin-top: .5rem; border-top: 1px solid $border; }
.project-footer .ownership { background: $panel; border: 1px solid $border; border-radius: $radius; padding: .75rem .9rem; }
.project-footer .ownership h4 { margin: 0 0 .4rem; font-size: .95rem; color: $ink; }
.project-footer .ownership ul { margin: 0 0 .1rem 1.3rem; padding: 0; }
.project-footer .ownership li { margin: .25rem 0; }
.project-footer .ownership li::marker { color: $muted; }
.project-footer .team { margin-top: .35rem; color: $ink; }
.project-footer .label { color: $muted; margin-right: .35rem; }

/* Inline team list */
.inline-list { list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: .35rem .8rem; }
.inline-list li::marker { content: none; }

/* Last-child spacing */
.project-section > *:last-child { margin-bottom: 1rem; }

/* -----------------------------
   Mobile-only behavior (<=820px)
   ----------------------------- */
@media (max-width: 820px) {
  /* Ensure nothing exceeds viewport width */
  .projects-page,
  .project-section,
  .project-hero,
  .project-gallery,
  .project-links,
  .highlights,
  .case-study,
  .project-footer { max-inline-size: 100%; }

  /* Metrics: horizontal swipe on mobile (no page widen) */
  .impact-grid {
    max-width: 100%;
    display: flex !important;
    overflow-x: auto;
    gap: .75rem;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }
  .impact-grid .impact-card {
    flex: 0 0 260px;
    min-width: 260px;
    scroll-snap-align: start;
  }

  /* ToC: remove active highlight on mobile */
  .projects-toc a.active {
    border-color: transparent !important;
    box-shadow: none !important;
    background: transparent !important;
  }
}
